<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ãƒ¼ãƒ«ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (Cloud)</title>
    <meta name="description" content="å…ç«¥ã®å­¦ç¿’ã§ä½¿ç”¨ã™ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ãƒ¼ãƒ«ã‚’Firebaseã§ç®¡ç†ã§ãã‚‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰">
    <style>
        :root {
            --bg-primary: #f0f4f8;
            --bg-secondary: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-sm: 8px;

            /* æ•™ç§‘åˆ¥ã‚«ãƒ©ãƒ¼ */
            --color-kokugo: #ef4444;
            --color-sansu: #3b82f6;
            --color-rika: #22c55e;
            --color-shakai: #f97316;
            --color-eigo: #a855f7;
            --color-ongaku: #ec4899;
            --color-zuko: #eab308;
            --color-taiiku: #06b6d4;
            --color-sonota: #6b7280;

            /* æ–°ã—ã„æ•™ç§‘ */
            --color-dotoku: #14b8a6;
            --color-kateika: #f43f5e;
            --color-sogo: #6366f1;
            --color-gakkatsu: #84cc16;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header h1::before {
            content: 'â˜ï¸';
            font-size: 1.5rem;
        }

        .add-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transform: translateY(-2px);
        }

        .auth-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .login-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: white;
            color: #1a202c;
        }

        .user-info {
            font-size: 0.9rem;
            margin-right: 0.5rem;
        }

        .add-btn:hover {
            background: white;
            color: #1a202c;
            transform: translateY(-2px);
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* æ•™ç§‘ã‚¿ãƒ– */
        .subject-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .tab-btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-primary);
            color: var(--text-secondary);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .tab-btn.active {
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .tab-btn[data-subject="all"].active {
            background: #2d3748;
        }

        .tab-btn[data-subject="å›½èª"].active {
            background: var(--color-kokugo);
        }

        .tab-btn[data-subject="ç®—æ•°"].active {
            background: var(--color-sansu);
        }

        .tab-btn[data-subject="ç†ç§‘"].active {
            background: var(--color-rika);
        }

        .tab-btn[data-subject="ç¤¾ä¼š"].active {
            background: var(--color-shakai);
        }

        .tab-btn[data-subject="è‹±èª"].active {
            background: var(--color-eigo);
        }

        .tab-btn[data-subject="éŸ³æ¥½"].active {
            background: var(--color-ongaku);
        }

        .tab-btn[data-subject="å›³å·¥"].active {
            background: var(--color-zuko);
        }

        .tab-btn[data-subject="ä½“è‚²"].active {
            background: var(--color-taiiku);
        }

        .tab-btn[data-subject="ãã®ä»–"].active {
            background: var(--color-sonota);
        }

        .tab-btn[data-subject="é“å¾³"].active {
            background: var(--color-dotoku);
        }

        .tab-btn[data-subject="å®¶åº­ç§‘"].active {
            background: var(--color-kateika);
        }

        .tab-btn[data-subject="ç·åˆ"].active {
            background: var(--color-sogo);
        }

        .tab-btn[data-subject="å­¦æ´»"].active {
            background: var(--color-gakkatsu);
        }

        /* ãƒ„ãƒ¼ãƒ«ã‚°ãƒªãƒƒãƒ‰ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* ãƒ„ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ */
        .tool-card {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
        }

        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            height: 8px;
            width: 100%;
        }

        .card-header.å›½èª {
            background: var(--color-kokugo);
        }

        .card-header.ç®—æ•° {
            background: var(--color-sansu);
        }

        .card-header.ç†ç§‘ {
            background: var(--color-rika);
        }

        .card-header.ç¤¾ä¼š {
            background: var(--color-shakai);
        }

        .card-header.è‹±èª {
            background: var(--color-eigo);
        }

        .card-header.éŸ³æ¥½ {
            background: var(--color-ongaku);
        }

        .card-header.å›³å·¥ {
            background: var(--color-zuko);
        }

        .card-header.ä½“è‚² {
            background: var(--color-taiiku);
        }

        .card-header.ãã®ä»– {
            background: var(--color-sonota);
        }

        .card-header.é“å¾³ {
            background: var(--color-dotoku);
        }

        .card-header.å®¶åº­ç§‘ {
            background: var(--color-kateika);
        }

        .card-header.ç·åˆ {
            background: var(--color-sogo);
        }

        .card-header.å­¦æ´» {
            background: var(--color-gakkatsu);
        }

        .card-content {
            padding: 1.25rem;
        }

        .card-subject {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.75rem;
        }

        .card-subject.å›½èª {
            background: var(--color-kokugo);
        }

        .card-subject.ç®—æ•° {
            background: var(--color-sansu);
        }

        .card-subject.ç†ç§‘ {
            background: var(--color-rika);
        }

        .card-subject.ç¤¾ä¼š {
            background: var(--color-shakai);
        }

        .card-subject.è‹±èª {
            background: var(--color-eigo);
        }

        .card-subject.éŸ³æ¥½ {
            background: var(--color-ongaku);
        }

        .card-subject.å›³å·¥ {
            background: var(--color-zuko);
        }

        .card-subject.ä½“è‚² {
            background: var(--color-taiiku);
        }

        .card-subject.ãã®ä»– {
            background: var(--color-sonota);
        }

        .card-subject.é“å¾³ {
            background: var(--color-dotoku);
        }

        .card-subject.å®¶åº­ç§‘ {
            background: var(--color-kateika);
        }

        .card-subject.ç·åˆ {
            background: var(--color-sogo);
        }

        .card-subject.å­¦æ´» {
            background: var(--color-gakkatsu);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .card-url {
            font-size: 0.8rem;
            color: var(--text-secondary);
            word-break: break-all;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-btn {
            flex: 1;
            padding: 0.625rem;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .open-btn {
            background: #2d3748;
            color: white;
        }

        .open-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .edit-btn {
            background: var(--bg-primary);
            color: var(--text-secondary);
        }

        .edit-btn:hover {
            background: #e2e8f0;
        }

        .delete-btn {
            background: #fee2e2;
            color: #dc2626;
            flex: 0.5;
        }

        .delete-btn:hover {
            background: #fecaca;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: var(--radius);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2d3748;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: #2d3748;
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            background: #1a202c;
        }

        /* èª­ã¿è¾¼ã¿ä¸­è¡¨ç¤º */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 1rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid #2d3748;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ç©ºçŠ¶æ…‹ */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.25rem;
            }

            .add-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            .container {
                padding: 1rem;
            }

            .subject-tabs {
                padding: 0.75rem;
            }

            .tab-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }

            .tools-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        .delete-btn-confirm:hover {
            background: #b91c1c !important;
        }

        .cancel-btn:hover {
            background: #a0aec0 !important;
        }
    </style>
</head>

<body>
    <div id="loadingOverlay">
        <div class="spinner"></div>
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>

    <header class="header">
        <div class="header-content">
            <h1>ãƒ‡ã‚¸æ´»ãƒ„ãƒ¼ãƒ«ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆï¼‰</h1>
            <div class="auth-container">
                <a href="view.html" class="login-btn"
                    style="text-decoration: none; background: #4299e1; border: none;">ğŸ‘§ å…ç«¥ç”¨ãƒšãƒ¼ã‚¸</a>
                <div id="userInfo" class="user-info" style="display: none;"></div>
                <button class="login-btn" id="loginBtn">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button class="login-btn" id="logoutBtn" style="display: none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                <button class="add-btn" id="openModalBtn" style="display: none;">
                    <span>ï¼‹</span> ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ 
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <nav class="subject-tabs" id="subjectTabs">
            <button class="tab-btn active" data-subject="all">ğŸ“š ã™ã¹ã¦</button>
            <button class="tab-btn" data-subject="å›½èª">ğŸ“– å›½èª</button>
            <button class="tab-btn" data-subject="ç®—æ•°">ğŸ”¢ ç®—æ•°</button>
            <button class="tab-btn" data-subject="ç†ç§‘">ğŸ”¬ ç†ç§‘</button>
            <button class="tab-btn" data-subject="ç¤¾ä¼š">ğŸŒ ç¤¾ä¼š</button>
            <button class="tab-btn" data-subject="è‹±èª">ğŸ”¤ è‹±èª</button>
            <button class="tab-btn" data-subject="éŸ³æ¥½">ğŸµ éŸ³æ¥½</button>
            <button class="tab-btn" data-subject="å›³å·¥">ğŸ¨ å›³å·¥</button>
            <button class="tab-btn" data-subject="ä½“è‚²">âš½ ä½“è‚²</button>
            <button class="tab-btn" data-subject="é“å¾³">ğŸ§¡ é“å¾³</button>
            <button class="tab-btn" data-subject="å®¶åº­ç§‘">ğŸ³ å®¶åº­ç§‘</button>
            <button class="tab-btn" data-subject="ç·åˆ">ğŸ” ç·åˆ</button>
            <button class="tab-btn" data-subject="å­¦æ´»">ğŸ« å­¦æ´»</button>
            <button class="tab-btn" data-subject="ãã®ä»–">ğŸ“ ãã®ä»–</button>
        </nav>

        <div class="tools-grid" id="toolsGrid">
            <!-- ãƒ„ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </div>

        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-state-icon">ğŸ“­</div>
            <h3>ãƒ„ãƒ¼ãƒ«ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</h3>
            <p>ã€Œï¼‹ ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ„ãƒ¼ãƒ«ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„</p>
        </div>
    </main>

    <!-- è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ </h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="toolForm">
                    <input type="hidden" id="toolId">
                    <div class="form-group">
                        <label for="toolName">ãƒ„ãƒ¼ãƒ«å *</label>
                        <input type="text" id="toolName" placeholder="ä¾‹: NHK for School" required>
                    </div>
                    <div class="form-group">
                        <label for="toolUrl">URL *</label>
                        <input type="url" id="toolUrl" placeholder="ä¾‹: https://www.nhk.or.jp/school/" required>
                    </div>
                    <div class="form-group">
                        <label for="toolSubject">æ•™ç§‘ *</label>
                        <select id="toolSubject" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="å›½èª">å›½èª</option>
                            <option value="ç®—æ•°">ç®—æ•°</option>
                            <option value="ç†ç§‘">ç†ç§‘</option>
                            <option value="ç¤¾ä¼š">ç¤¾ä¼š</option>
                            <option value="è‹±èª">è‹±èª</option>
                            <option value="éŸ³æ¥½">éŸ³æ¥½</option>
                            <option value="å›³å·¥">å›³å·¥</option>
                            <option value="ä½“è‚²">ä½“è‚²</option>
                            <option value="é“å¾³">é“å¾³</option>
                            <option value="å®¶åº­ç§‘">å®¶åº­ç§‘</option>
                            <option value="ç·åˆ">ç·åˆ</option>
                            <option value="å­¦æ´»">å­¦æ´»</option>
                            <option value="ãã®ä»–">ãã®ä»–</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn" id="submitBtn">è¿½åŠ ã™ã‚‹</button>
                </form>
            </div>
        </div>
    </div>

    <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="deleteModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2>å‰Šé™¤ã®ç¢ºèª</h2>
                <button class="close-btn" id="closeDeleteModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>æœ¬å½“ã«ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
                <p id="deleteToolName" style="font-weight: bold; margin: 1rem 0;"></p>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button class="submit-btn delete-btn-confirm" id="confirmDeleteBtn"
                        style="background: #dc2626;">å‰Šé™¤ã™ã‚‹</button>
                    <button class="submit-btn cancel-btn" id="cancelDeleteBtn"
                        style="background: #cbd5e0; color: #4a5568;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            getDocs,
            updateDoc,
            deleteDoc,
            doc,
            query,
            orderBy,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";
        import {
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

        // å®šæ•°
        const ADMIN_EMAIL = 'd.a0807derude@gmail.com';

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBx2B8AemAyoXFNR6kmWk1OCsnUNHFc4kI",
            authDomain: "gen-lang-client-0309545089.firebaseapp.com",
            projectId: "gen-lang-client-0309545089",
            storageBucket: "gen-lang-client-0309545089.firebasestorage.app",
            messagingSenderId: "400466016438",
            appId: "1:400466016438:web:eed4fc62974097e26cce17",
            measurementId: "G-XL68PEV1QD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const toolsCol = collection(db, 'tools');

        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¯ãƒ©ã‚¹
        class ToolManager {
            constructor() {
                this.tools = [];
            }

            async loadTools() {
                try {
                    const q = query(toolsCol, orderBy('createdAt', 'desc'));
                    const querySnapshot = await getDocs(q);
                    this.tools = querySnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    return this.tools;
                } catch (error) {
                    console.error("Error loading tools:", error);
                    alert("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Firestoreã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                    return [];
                }
            }

            async addTool(tool) {
                const docRef = await addDoc(toolsCol, {
                    ...tool,
                    createdAt: serverTimestamp()
                });
                return { id: docRef.id, ...tool };
            }

            async updateTool(id, toolData) {
                const toolRef = doc(db, 'tools', id);
                await updateDoc(toolRef, toolData);
                return { id, ...toolData };
            }

            async deleteTool(id) {
                const toolRef = doc(db, 'tools', id);
                await deleteDoc(toolRef);
            }

            getTools(subject = 'all') {
                if (subject === 'all') {
                    return this.tools;
                }
                return this.tools.filter(t => t.subject === subject);
            }

            getToolById(id) {
                return this.tools.find(t => t.id === id);
            }
        }

        // UIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
        class UIController {
            constructor(toolManager) {
                this.toolManager = toolManager;
                this.currentSubject = 'all';
                this.editingId = null;
                this.pendingDeleteId = null;
                this.isAdmin = false;

                this.initElements();
                this.initEventListeners();
                this.initializeApp();
            }

            initElements() {
                this.toolsGrid = document.getElementById('toolsGrid');
                this.emptyState = document.getElementById('emptyState');
                this.modalOverlay = document.getElementById('modalOverlay');
                this.modalTitle = document.getElementById('modalTitle');
                this.toolForm = document.getElementById('toolForm');
                this.toolIdInput = document.getElementById('toolId');
                this.toolNameInput = document.getElementById('toolName');
                this.toolUrlInput = document.getElementById('toolUrl');
                this.toolSubjectInput = document.getElementById('toolSubject');
                this.submitBtn = document.getElementById('submitBtn');
                this.subjectTabs = document.getElementById('subjectTabs');
                this.loadingOverlay = document.getElementById('loadingOverlay');

                // èªè¨¼è¦ç´ 
                this.loginBtn = document.getElementById('loginBtn');
                this.logoutBtn = document.getElementById('logoutBtn');
                this.userInfo = document.getElementById('userInfo');
                this.openModalBtn = document.getElementById('openModalBtn');

                // å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ 
                this.deleteModalOverlay = document.getElementById('deleteModalOverlay');
                this.deleteToolName = document.getElementById('deleteToolName');
                this.confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
                this.cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            }

            initEventListeners() {
                // èªè¨¼
                this.loginBtn.addEventListener('click', () => this.handleLogin());
                this.logoutBtn.addEventListener('click', () => this.handleLogout());

                // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰
                this.openModalBtn.addEventListener('click', () => this.openModal());
                document.getElementById('closeModalBtn').addEventListener('click', () => this.closeModal());
                this.modalOverlay.addEventListener('click', (e) => {
                    if (e.target === this.modalOverlay) this.closeModal();
                });

                // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
                this.toolForm.addEventListener('submit', (e) => this.handleSubmit(e));

                // æ•™ç§‘ã‚¿ãƒ–
                this.subjectTabs.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab-btn')) {
                        this.selectSubject(e.target.dataset.subject);
                    }
                });

                // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                        this.closeDeleteModal();
                    }
                });

                // å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«
                document.getElementById('closeDeleteModalBtn').addEventListener('click', () => this.closeDeleteModal());
                this.cancelDeleteBtn.addEventListener('click', () => this.closeDeleteModal());
                this.confirmDeleteBtn.addEventListener('click', () => this.executeDelete());
                this.deleteModalOverlay.addEventListener('click', (e) => {
                    if (e.target === this.deleteModalOverlay) this.closeDeleteModal();
                });
            }

            showLoading() { this.loadingOverlay.style.display = 'flex'; }
            hideLoading() { this.loadingOverlay.style.display = 'none'; }

            async initializeApp() {
                this.showLoading();

                // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
                onAuthStateChanged(auth, (user) => {
                    this.handleAuthStateChange(user);
                });

                await this.toolManager.loadTools();
                this.renderTools();
                this.hideLoading();
            }

            async handleLogin() {
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Login failed:", error);
                    alert("ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                }
            }

            async handleLogout() {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Logout failed:", error);
                }
            }

            handleAuthStateChange(user) {
                if (user) {
                    this.isAdmin = (user.email === ADMIN_EMAIL);
                    this.userInfo.textContent = user.email;
                    this.userInfo.style.display = 'block';
                    this.loginBtn.style.display = 'none';
                    this.logoutBtn.style.display = 'block';

                    if (this.isAdmin) {
                        this.openModalBtn.style.display = 'flex';
                    } else {
                        this.openModalBtn.style.display = 'none';
                    }
                } else {
                    this.isAdmin = false;
                    this.userInfo.style.display = 'none';
                    this.loginBtn.style.display = 'block';
                    this.logoutBtn.style.display = 'none';
                    this.openModalBtn.style.display = 'none';
                }
                this.renderTools();
            }

            openModal(tool = null) {
                this.editingId = tool ? tool.id : null;
                this.modalTitle.textContent = tool ? 'ãƒ„ãƒ¼ãƒ«ã‚’ç·¨é›†' : 'ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ';
                this.submitBtn.textContent = tool ? 'æ›´æ–°ã™ã‚‹' : 'è¿½åŠ ã™ã‚‹';

                if (tool) {
                    this.toolIdInput.value = tool.id;
                    this.toolNameInput.value = tool.name;
                    this.toolUrlInput.value = tool.url;
                    this.toolSubjectInput.value = tool.subject;
                } else {
                    this.toolForm.reset();
                    this.toolIdInput.value = '';
                }

                this.modalOverlay.classList.add('active');
                this.toolNameInput.focus();
            }

            closeModal() {
                this.modalOverlay.classList.remove('active');
                this.editingId = null;
                this.toolForm.reset();
            }

            async handleSubmit(e) {
                e.preventDefault();
                this.showLoading();

                const toolData = {
                    name: this.toolNameInput.value.trim(),
                    url: this.toolUrlInput.value.trim(),
                    subject: this.toolSubjectInput.value
                };

                try {
                    if (this.editingId) {
                        await this.toolManager.updateTool(this.editingId, toolData);
                    } else {
                        await this.toolManager.addTool(toolData);
                    }

                    await this.toolManager.loadTools(); // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
                    this.closeModal();
                    this.renderTools();
                } catch (error) {
                    console.error("Error submitting tool:", error);
                    alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                } finally {
                    this.hideLoading();
                }
            }

            selectSubject(subject) {
                this.currentSubject = subject;

                // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.subject === subject);
                });

                this.renderTools();
            }

            renderTools() {
                const tools = this.toolManager.getTools(this.currentSubject);

                if (tools.length === 0) {
                    this.toolsGrid.innerHTML = '';
                    this.emptyState.style.display = 'block';
                    return;
                }

                this.emptyState.style.display = 'none';
                this.toolsGrid.innerHTML = tools.map(tool => this.createToolCard(tool)).join('');

                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                this.toolsGrid.querySelectorAll('.open-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        window.open(btn.dataset.url, '_blank');
                    });
                });

                this.toolsGrid.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tool = this.toolManager.getToolById(btn.dataset.id);
                        if (tool) this.openModal(tool);
                    });
                });

                this.toolsGrid.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tool = this.toolManager.getToolById(btn.dataset.id);
                        if (tool) this.openDeleteModal(tool);
                    });
                });
            }

            createToolCard(tool) {
                return `
                    <div class="tool-card">
                        <div class="card-header ${tool.subject}"></div>
                        <div class="card-content">
                            <span class="card-subject ${tool.subject}">${tool.subject}</span>
                            <h3 class="card-title">${this.escapeHtml(tool.name)}</h3>
                            <p class="card-url">${this.escapeHtml(tool.url)}</p>
                            <div class="card-actions">
                                <button class="card-btn open-btn" data-url="${this.escapeHtml(tool.url)}">é–‹ã</button>
                                ${this.isAdmin ? `
                                <button class="card-btn edit-btn" data-id="${tool.id}">ç·¨é›†</button>
                                <button class="card-btn delete-btn" data-id="${tool.id}">ğŸ—‘</button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            openDeleteModal(tool) {
                this.pendingDeleteId = tool.id;
                this.deleteToolName.textContent = tool.name;
                this.deleteModalOverlay.classList.add('active');
            }

            closeDeleteModal() {
                this.deleteModalOverlay.classList.remove('active');
                this.pendingDeleteId = null;
            }

            async executeDelete() {
                if (!this.pendingDeleteId) return;

                this.showLoading();
                try {
                    await this.toolManager.deleteTool(this.pendingDeleteId);
                    await this.toolManager.loadTools();
                    this.renderTools();
                    this.closeDeleteModal();
                } catch (error) {
                    console.error("Error deleting tool:", error);
                    alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                } finally {
                    this.hideLoading();
                }
            }
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        const toolManager = new ToolManager();
        const uiController = new UIController(toolManager);
    </script>
</body>

</html>